if kakao 2020

https://if.kakao.com/session


## if kakao 2019 - 카카오톡 적용 사례를 통해 살펴보는 카카오 클라우드의 Kubernetes as a Service
- 쿠버네티스 장점
  - 모놀리틱 아키텍처 단점
    - 어플리케이션 내 상호 의존성 복잡도, 배포 및 기동 시간 오래 걸림, 지속적 빌드/통합 어려움
  - MSA 단점
    - 하나의 서버 OS 환경에 다양한 언어와 버전의 App 설치/관리 어려움
    - App 별 성능 분배 및 격리 필요 (CPU/MEM)
    - 로드밸런싱 설정 복잡해짐
  - Container와 Orchestrator 등장
    - Container (Docker)
    - Orchestrator (Kubernate)
      - 컨테이너 단위의 어플리케이션과 로드밸런서 연결을 자동으로 제어 하며 서비스 중단 없는 배포를 자동화
      - Service/ Ingress
      - Kube-DNS/Core-DNS
      - Self-healing : Application 이 죽으면 다른 서버에 자동으로 살려줌
- 카카오는 쿠버네티스를 어떻게 쓰고 있나?
  - 쿠버네티스를 도입한다면 가장 고민해야 되는 부분?
    - 하나의 클러스터를 네임 스페이스를 쪼개서 사용할 것이냐 여러개 클러스터를 나눠서 사용할거냐
      - 하나의 클러스터를 네임 스페이스 : 동일 설정, 동일 환경
        - ex) health Check interval등 공통, 하나의 Cluster DNS
        - worker 노드의 자원을 공유
          - 테스트1, 서비스1이 같은 자원 공유시, 테스트1에서 부하 테스트를 하면 서비스1 에도 영향을 준다.
        - 장점 : Cluster Management  / 관리가 편함, 자원 효율성 좋음
        - 단점 : Admission Control / 관리가 어려움, 멀티 클러스터 전략 안 좋음
      - 멀티 클러스터 전략
        - 네임스페이스가 아닌 클러스터 개념
        - 각 개별의 마스터
        - 장점 : Cluster Management  / 관리가 어려움 (개별 관리), isolation, 보안 측면에서 좋음
        - 단점 : Admission Control / 관리가 쉬움 , 자원 효율성 나쁨, 멀티 클러스터 전략 좋음
          - DKOS에서는 해당 단점 보완
- Private Cloud에서 Kubernetes as a service 운영
  - Ingress : ingress-nginx-controller
    - 카카오 인증을 처리하기 위해 kakao-auth
  - LoadBalancer : 물리 장비
  - DNS : inhouse-dns-manager
    - before : Cluster DNS로 kube-dns 사용
      - kube-dns가 죽거나 kube-dns가 동작중인 Node가 죽으면 k8s가 감지하고 fail-over 처리
    - after : inhouse-dns-controller
      - 필요한 정보를 사내 물리 DNS
      - 마스터 노드가 죽어도 서비스에 영향을 받지 않는다?
        - 왜냐면 클러스터 내부에는 DNS를 갖지 않기 때문에
      - 물리 장비기 때문에 대규모 트래픽도 문제가 없다.
